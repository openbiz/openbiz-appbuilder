{
    "type": "module",
    "app": {
        "name": "dss",
        "displayName": "决策支持系统",
        "url": "/dss"
    },
    "name": "productPlan",
    "displayName": "商品计划",
    "models": [
        {
            "name": "ProductPlan",
            "collection": "dss_product_plan",
            "schema": {
                "bandno": {
                    "type": "String",
                    "required": true,
                    "unique": true
                },
                "brand": {
                    "type": "String"
                },
                "year": {
                    "type": "String",
                    "required": true
                },
                "quarter": {
                    "type": "String"
                },
                "topic": {
                    "type": "String"
                },
                "publicDate": {
                    "type": "Date",
                    "required": true
                },
                "researchSubmitDate": {
                    "type": "Date",
                    "required": true
                },
                "headSubmitDate": {
                    "type": "Date"
                },
                "tailSubmitDate": {
                    "type": "Date"
                },
                "styleCategoryPlan": [
                    {
                        "styleCategory": {
                            "type": "String",
                            "required": true,
                            "unique": true
                        },
                        "planCategoryCount": {
                            "type": "Number",
                            "required": true
                        },
                        "planQuantity": {
                            "type": "Number",
                            "required": true
                        },
                        "planUnitPrice": {
                            "type": "Number",
                            "required": true
                        },
                        "oldCategoryCount": {
                            "type": "Number"
                        },
                        "oldQuantity": {
                            "type": "Number"
                        },
                        "newUnitPrice": {
                            "type": "Number"
                        }
                    }
                ]
            },
            "functions": {
                "statics": [],
                "methods": []
            }
        }
    ],
    "controllers": [
        {
            "name": "ProductPlanController",
            "model": "ProductPlan",
            "type": "ModelController",
            "functions": []
        },
        {
            "name": "ProductPlanStyleCategroyController",
            "model": "ProductPlan",
            "path": "styleCategoryPlan",
            "type": "ModelSubdocController",
            "functions": []
        }
    ],
    "routes": {
        "post /product-plans": {
            "permissions": ["dss-product-plan-manage"],
            "action": "ProductPlanController.create"
        },
        "post /product-plans/:id/style-category-plans": {
            "permissions": ["dss-product-plan-manage"],
            "action": "ProductPlanStyleCategroyController.create"
        },
        "get /product-plans": {
            "permissions": ["dss-product-plan-access"],
            "action": "ProductPlanController.getCollection"
        },
        "get /product-plans/:id/style-category-plans": {
            "permissions": ["dss-product-plan-access"],
            "action": "ProductPlanStyleCategroyController.getCollection"
        },
        "put /product/plan/:id": {
            "permissions": ["dss-product-plan-manage"],
            "action": "ProductPlanController.update"
        },
        "put /product-plans/:id/style-category-plans/:subId": {
            "permissions": ["dss-product-plan-manage"],
            "action": "ProductPlanStyleCategroyController.update"
        },
        "delete /product/plan/:id": {
            "permissions": ["dss-product-plan-manage"],
            "action": "ProductPlanController.delete"
        },
        "delete /product-plans/:id/style-category-plans/:subId": {
            "permissions": ["dss-product-plan-manage"],
            "action": "ProductPlanStyleCategroyController.delete"
        },
        "get /product/plan/:id": {
            "permissions": ["dss-product-plan-access"],
            "action": "ProductPlanController.getItem"
        },
        "get /product-plans/:id/style-category-plans/:subId": {
            "permissions": ["dss-product-plan-access"],
            "action": "ProductPlanStyleCategroyController.create"
        }
    },
    "clientModels": [
        {
            "resourceUri": "/product-plans",
            "itemModel": {
                "name": "ProductPlan",
                "functions": [
                    {
                        "name": "getSumPlanCategoryCount",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('planCategoryCount').length;i++){result+=(this.get('planCategoryCount'))[i] };return result;"
                    },
                    {
                        "name": "getSumPlanQuantity",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('planQuantity').length;i++){result+=(this.get('planQuantity'))[i] };return result;"
                    },
                    {
                        "name": "getSumPlanAmount",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('planAmount').length;i++){result+=(this.get('planAmount'))[i] };return result;"
                    },
                    {
                        "name": "getSumOldCategoryCount",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('oldCategoryCount').length;i++){result+=(this.get('oldCategoryCount'))[i] };return result;"
                    },
                    {
                        "name": "getSumOldQuantity",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('oldQuantity').length;i++){result+=(this.get('oldQuantity'))[i] };return result;"
                    },
                    {
                        "name": "getSumOldAmount",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('oldAmount').length;i++){result+=(this.get('oldAmount'))[i] };return result;"
                    },
                    {
                        "name": "getSumNewCategoryCount",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('planPlanQuantity').length;i++){result+=(this.get('planPlanQuantity'))[i] };return result;"
                    },
                    {
                        "name": "getSumNewQuantity",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('newQuantity').length;i++){result+=(this.get('newQuantity'))[i] };return result;"
                    },
                    {
                        "name": "getSumNewAmount",
                        "parameters": "",
                        "function": "var result=0;for(var i=0;i<this.get('newAmount').length;i++){result+=(this.get('newAmount'))[i] };return result;"
                    }
                ]
            },
            "collectionModel": {
                "name": "ProductPlanCollection",
                "fuctions": []
            }
        },
        {
            "resourceUri": "/product-plans/:id/style-category-plans",
            "itemModel": {
                "name": "ProductPlanStyleCategory",
                "fuctions": [
                    {
                        "name": "getPlanAmount",
                        "parameters": "",
                        "function": "return this.get('planQuantity') * this.get('planUnitPrice');"
                    },
                    {
                        "name": "getNewCategoryCount",
                        "parameters": "",
                        "function": "return this.get('planCategoryCount') - this.get('oldCategoryCount');"
                    },
                    {
                        "getNewQuantity": "getNewPlanQuantity",
                        "parameters": "",
                        "function": "return this.get('planQuantity') - this.get('oldQuantity');"
                    },
                    {
                        "getNewQuantity": "getNewAmount",
                        "parameters": "",
                        "function": "return (this.get('planQuantity') - this.get('oldQuantity')) * this.get('newPlanUnitPrice');"
                    }
                ]
            },
            "collectionModel": {
                "name": "ProductPlanStyleCategoryCollection",
                "fuctions": []
            }
        }
    ],
    "views": [
        {
            "name": "productPlanListView",
            "displayName": "Product Plan",
            "description": "商品计划",
            "permission": "dss-product-plan-access",
            "type": "gridForm",
            "model": "ProductPlan",
            "url": "/product-plans",
            "fields": [
                {
                    "name": "bandno",
                    "field": "bandno",
                    "displayName": "波段编号",
                    "className": "",
                    "type": "link",
                    "url": "/product-plans/:id"
                },
                {
                    "name": "brand",
                    "field": "brand",
                    "displayName": "品牌",
                    "className": "hidden-xs"
                },
                {
                    "name": "year",
                    "field": "year",
                    "displayName": "年度",
                    "className": "hidden-xs"
                },
                {
                    "name": "quarter",
                    "field": "quarter",
                    "displayName": "季度",
                    "className": "hidden-xs"
                },
                {
                    "name": "topic",
                    "field": "topic",
                    "displayName": "主题",
                    "className": "hidden-xs"
                },
                {
                    "name": "publicDate",
                    "field": "publicData",
                    "displayName": "上市日期",
                    "hint": "",
                    "default": ""
                },
                {
                    "name": "researchSubmitDate",
                    "field": "researchSubmitDate",
                    "displayName": "研发交期",
                    "className": "hidden-xs"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "头单截止",
                    "hint": "头单截至入库日期",
                    "className": "hidden-xs"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "尾单截止",
                    "className": "hidden-xs"
                },
                {
                    "name": "planCategoryCount",
                    "field": "<%= this.model.getSumPlanCategoryCount %>",
                    "displayName": "计划款量"
                },
                {
                    "name": "planQuantity",
                    "field": "<%= this.model.getSumPlanQuantity %>",
                    "displayName": "计划数量"
                },
                {
                    "name": "planQuantity",
                    "field": "<%= this.model.getSumNewCategoryCount %>",
                    "displayName": "新品款量"
                },
                {
                    "name": "planQuantity",
                    "field": "<%= this.model.getSumNewPlanQuantity %>",
                    "displayName": "新品数量"
                }
            ],
            "paginator": true,
            "filter": true,
            "recordActions": [
                {
                    "name": "delete",
                    "displayName": "Delete",
                    "className": "hidden-xs",
                    "type": "Button",
                    "event": "click",
                    "function": "deleteRecord",
                    "permission": "dss-product-plan-manage"
                }
            ],
            "actions": [
                {
                    "name": "new",
                    "type": "link",
                    "url": "/tests/new",
                    "className": "btn-theme x-large",
                    "permission": "test-info-manage"
                },
                {
                    "name": "test",
                    "displayName": "Stat Func",
                    "type": "button",
                    "function": "statFunc2",
                    "permission": "test-info-manage"
                }
            ],
            "functions": [
                {
                    "name": "statFunc1",
                    "parameters": "arg1,arg2",
                    "function": " var x=123;return this; "
                },
                {
                    "name": "statFunc2",
                    "function": ""
                }
            ]
        },
        {
            "name": "productPlanEditView",
            "displayName": "商品计划修改",
            "type": "editForm",
            "permission": "dss-product-plan-manage",
            "model": "ProductPlan",
            "url": "/product-plans/:id/edit",
            "fields": [
                {
                    "name": "bandno",
                    "field": "bandno",
                    "displayName": "波段编号",
                    "className": "",
                    "type": "text"
                },
                {
                    "name": "brand",
                    "field": "brand",
                    "displayName": "品牌",
                    "className": "",
                    "type": "select",
                    "dataSource": {
                        "type": "model",
                        "model": "OtherCollection",
                        "path": "account.brands",
                        "key": "id",
                        "value": "displayName"
                    }
                },
                {
                    "name": "year",
                    "field": "year",
                    "displayName": "年度",
                    "className": "",
                    "type": "text"
                },
                {
                    "name": "quarter",
                    "field": "quarter",
                    "displayName": "季度",
                    "className": "",
                    "type": "select",
                    "dataSource": {
                        "type": "model",
                        "model": "OtherCollection",
                        "path": "account.quarters",
                        "key": "id",
                        "value": "displayName"
                    }
                },
                {
                    "name": "topic",
                    "field": "topic",
                    "displayName": "主题",
                    "className": "",
                    "type": "text"
                },
                {
                    "name": "publicDate",
                    "field": "publicData",
                    "displayName": "上市日期",
                    "className": "",
                    "type": "date"
                },
                {
                    "name": "researchSubmitDate",
                    "field": "researchSubmitDate",
                    "displayName": "研发交期",
                    "className": "",
                    "type": "date"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "头单截止",
                    "className": "",
                    "type": "date"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "尾单截止",
                    "className": "",
                    "type": "date"
                }
            ],
            "actions": [
                {
                    "name": "saveRecord",
                    "className": "",
                    "type": "button",
                    "event": "click",
                    "action": "saveRecord",
                    "gotoURL": "/product-plans/:id"
                },
                {
                    "name": "cancel",
                    "className": "",
                    "type": "link",
                    "url": "/product-plans"
                }
            ]
        },
        {
            "name": "productPlanDetailView",
            "displayName": "商品计划详情",
            "type": "detailForm",
            "url": "/plans/:id",
            "model": "ProductPlan",
            "fields": [
                {
                    "name": "bandno",
                    "field": "bandno",
                    "displayName": "波段编号",
                    "type": "label"
                },
                {
                    "name": "brand",
                    "field": "brand",
                    "displayName": "品牌",
                    "type": "label"
                },
                {
                    "name": "year",
                    "field": "year",
                    "displayName": "年度",
                    "type": "label"
                },
                {
                    "name": "quarter",
                    "field": "quarter",
                    "displayName": "季度",
                    "type": "label"
                },
                {
                    "name": "topic",
                    "field": "topic",
                    "displayName": "主题",
                    "type": "label"
                },
                {
                    "name": "publicDate",
                    "field": "publicData",
                    "displayName": "上市日期",
                    "type": "label"
                },
                {
                    "name": "researchSubmitDate",
                    "field": "researchSubmitDate",
                    "displayName": "研发交期",
                    "type": "label"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "头单截止",
                    "type": "label"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "尾单截止",
                    "type": "label"
                }
            ],
            "actions": [
                {
                    "name": "deleteRecord",
                    "className": "",
                    "type": "button",
                    "event": "click",
                    "action": "saveRecord",
                    "gotoURL": "/product-plans/:id"
                },
                {
                    "name": "back",
                    "className": "",
                    "type": "link",
                    "url": "/product-plans"
                }
            ]
        },
        {
            "name": "productPlanNewView",
            "displayName": "Create a Test Record",
            "type": "addForm",
            "model": "ProductPlan",
            "url": "/product/plans/new",
            "fields": [
                {
                    "name": "bandno",
                    "field": "bandno",
                    "displayName": "波段编号",
                    "className": "",
                    "type": "text"
                },
                {
                    "name": "brand",
                    "field": "brand",
                    "displayName": "品牌",
                    "className": "",
                    "type": "select",
                    "dataSource": {
                        "type": "model",
                        "model": "OtherCollection",
                        "path": "account.brands",
                        "key": "id",
                        "value": "displayName"
                    }
                },
                {
                    "name": "year",
                    "field": "year",
                    "displayName": "年度",
                    "className": "",
                    "type": "text"
                },
                {
                    "name": "quarter",
                    "field": "quarter",
                    "displayName": "季度",
                    "className": "",
                    "type": "select",
                    "dataSource": {
                        "type": "model",
                        "model": "OtherCollection",
                        "path": "account.quarters",
                        "key": "id",
                        "value": "displayName"
                    }
                },
                {
                    "name": "topic",
                    "field": "topic",
                    "displayName": "主题",
                    "className": "",
                    "type": "text"
                },
                {
                    "name": "publicDate",
                    "field": "publicData",
                    "displayName": "上市日期",
                    "className": "",
                    "type": "date"
                },
                {
                    "name": "researchSubmitDate",
                    "field": "researchSubmitDate",
                    "displayName": "研发交期",
                    "className": "",
                    "type": "date"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "头单截止",
                    "className": "",
                    "type": "date"
                },
                {
                    "name": "headSubmitDate",
                    "field": "headSubmitDate",
                    "displayName": "尾单截止",
                    "className": "",
                    "type": "date"
                }
            ],
            "actions": [
                {
                    "name": "saveRecord",
                    "className": "",
                    "type": "button",
                    "event": "click",
                    "action": "saveRecord",
                    "gotoURL": "/product-plans/:id"
                },
                {
                    "name": "cancel",
                    "className": "",
                    "type": "link",
                    "url": "/product-plans"
                }
            ]
        }
    ],

    "roles": [
        {
            "name": "dss-product-manager",
            "displayName": "商品管理",
            "permissions": [
                "dss-product-plan-access",
                "dss-product-plan-manage",
                "plan-menu-access"
            ],
            "isDefault": false
        },
        {
            "name": "dss-product-user",
            "displayName": "商品用户",
            "permissions": [
                "dss-product-plan-access",
                "plan-menu-access"
            ],
            "isDefault": true
        }
    ]
}